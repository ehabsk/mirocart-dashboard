
import axios from "axios";

const API_URL = "http://localhost:8088/api/index.php/orders";
const DOLAPIKEY = "M0L6lO8Dqh68jRGivY7cCt5To6MrjK41";  // Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø§Ù„ØªÙˆÙƒÙŠÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ

const sendOrder = async (cart, setCart) => {
  if (!cart || cart.length === 0) {
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ© ğŸ˜…");
    return;
  }

  const orderData = {
    socid: 1,
    date: Math.floor(Date.now() / 1000), // âœ… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© Unix timestamp
    lines: cart.map((item) => ({
      fk_product: item.id,
      qty: item.qty,
      
    })),
  };

  try {
    const response = await axios.post(API_URL, orderData, {
      headers: {
        "Content-Type": "application/json",
        DOLAPIKEY,
      },
    });

    console.log("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­:", response.data);
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
    setCart([]);

    return response.data;

  } catch (error) {
    console.error("âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:", error.message);

    if (error.response) {
      console.error("ğŸ“› Status Code:", error.response.status);
      console.error("ğŸ“© Response Data:", JSON.stringify(error.response.data, null, 2));
    } else if (error.request) {
      console.error("ğŸ“¡ No response received:", error.request);
    } else {
      console.error("âš™ï¸ Error setting up request:", error.message);
    }

    alert("âŒ Ø­ØµÙ„ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨!");
    throw new Error("Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙØ´Ù„");
  }
};

export default sendOrder;

